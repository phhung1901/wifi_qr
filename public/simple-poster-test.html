<!DOCTYPE html>
<html>
<head>
    <title>Simple Poster Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        #poster-preview { text-align: center; margin: 20px 0; }
        canvas { border: 2px solid #007bff; border-radius: 8px; max-width: 100%; height: auto; }
        button { margin: 5px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simple Poster Test</h1>
        
        <div class="test-section">
            <h2>Direct Canvas Test</h2>
            <button onclick="createDirectCanvas()">Create Direct Canvas</button>
            <div id="direct-canvas-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Poster Generator Test</h2>
            <button onclick="testPosterClass()">Test Poster Class</button>
            <button onclick="generateSimplePoster()">Generate Simple Poster</button>
            <button onclick="generateCafePoster()">Generate Cafe Poster</button>
            <div id="poster-preview"></div>
        </div>
        
        <div class="test-section">
            <h2>Debug Log</h2>
            <div id="debug-log" class="log"></div>
        </div>
    </div>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function createDirectCanvas() {
            log('Creating direct canvas...');
            
            const container = document.getElementById('direct-canvas-result');
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 600;
            
            const ctx = canvas.getContext('2d');
            
            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Title
            ctx.fillStyle = 'white';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('WiFi miễn phí', canvas.width/2, 80);
            
            // QR placeholder
            const qrSize = 150;
            const qrX = canvas.width/2 - qrSize/2;
            const qrY = 150;
            
            ctx.fillStyle = 'white';
            ctx.fillRect(qrX, qrY, qrSize, qrSize);
            ctx.fillStyle = 'black';
            ctx.fillRect(qrX + 20, qrY + 20, qrSize - 40, qrSize - 40);
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText('QR', canvas.width/2, qrY + qrSize/2 + 8);
            
            // Instructions
            ctx.fillStyle = '#f0f2ff';
            ctx.font = '20px Arial';
            ctx.fillText('Quét mã để kết nối', canvas.width/2, 380);
            
            // WiFi info
            ctx.font = '16px Arial';
            ctx.fillText('Mạng: TestWiFi', canvas.width/2, 420);
            
            container.innerHTML = '';
            container.appendChild(canvas);
            
            log('Direct canvas created successfully');
        }
        
        // Inline Poster Generator Class
        class SimplePosterGenerator {
            constructor() {
                this.canvas = null;
                this.ctx = null;
                this.currentSize = 'a5';
                
                this.posterSizes = {
                    a5: { width: 420, height: 595, name: 'A5' },
                    card: { width: 300, height: 420, name: 'Card' }
                };
                
                this.templates = {
                    simple: {
                        background: '#ffffff',
                        primaryColor: '#333333',
                        secondaryColor: '#666666'
                    },
                    cafe: {
                        background: 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)',
                        primaryColor: '#ffffff',
                        secondaryColor: '#f5f5dc'
                    }
                };
                
                this.createCanvas();
            }
            
            createCanvas() {
                this.canvas = document.createElement('canvas');
                this.ctx = this.canvas.getContext('2d');
                
                const size = this.posterSizes[this.currentSize];
                this.canvas.width = size.width;
                this.canvas.height = size.height;
                
                const container = document.getElementById('poster-preview');
                if (container) {
                    container.innerHTML = '';
                    container.appendChild(this.canvas);
                }
                
                log(`Canvas created: ${this.canvas.width}x${this.canvas.height}`);
            }
            
            drawBackground(template) {
                if (template.background.includes('gradient')) {
                    const colors = template.background.match(/#[0-9a-fA-F]{6}/g) || ['#ffffff', '#f0f0f0'];
                    const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
                    gradient.addColorStop(0, colors[0]);
                    gradient.addColorStop(1, colors[1] || colors[0]);
                    this.ctx.fillStyle = gradient;
                } else {
                    this.ctx.fillStyle = template.background;
                }
                
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                log('Background drawn');
            }
            
            drawText(text, x, y, options = {}) {
                const {
                    fontSize = 20,
                    color = '#000000',
                    align = 'center',
                    weight = 'normal'
                } = options;
                
                this.ctx.font = `${weight} ${fontSize}px Arial`;
                this.ctx.fillStyle = color;
                this.ctx.textAlign = align;
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(text, x, y);
            }
            
            generatePoster(templateName = 'simple') {
                log(`Generating ${templateName} poster...`);
                
                const template = this.templates[templateName];
                if (!template) {
                    log(`Template ${templateName} not found`);
                    return;
                }
                
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw background
                this.drawBackground(template);
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                // Title
                this.drawText('WiFi miễn phí', centerX, centerY - 150, {
                    fontSize: Math.min(32, this.canvas.width / 10),
                    color: template.primaryColor,
                    weight: 'bold'
                });
                
                // QR placeholder
                const qrSize = Math.min(this.canvas.width * 0.4, 120);
                const qrX = centerX - qrSize/2;
                const qrY = centerY - qrSize/2;
                
                this.ctx.fillStyle = template.primaryColor;
                this.ctx.fillRect(qrX, qrY, qrSize, qrSize);
                this.ctx.fillStyle = template.background.includes('gradient') ? '#ffffff' : template.background;
                this.ctx.fillRect(qrX + 10, qrY + 10, qrSize - 20, qrSize - 20);
                
                this.drawText('QR', centerX, centerY, {
                    fontSize: 16,
                    color: template.primaryColor
                });
                
                // Instructions
                this.drawText('Quét mã để kết nối', centerX, centerY + 100, {
                    fontSize: Math.min(20, this.canvas.width / 15),
                    color: template.secondaryColor
                });
                
                // WiFi info
                this.drawText('Mạng: TestWiFi', centerX, centerY + 140, {
                    fontSize: Math.min(16, this.canvas.width / 20),
                    color: template.secondaryColor
                });
                
                log(`${templateName} poster generated successfully`);
            }
        }
        
        let posterGenerator = null;
        
        function testPosterClass() {
            log('Testing poster class...');
            try {
                posterGenerator = new SimplePosterGenerator();
                log('Poster generator created successfully');
            } catch (error) {
                log('Error creating poster generator: ' + error.message);
            }
        }
        
        function generateSimplePoster() {
            if (!posterGenerator) {
                testPosterClass();
            }
            posterGenerator.generatePoster('simple');
        }
        
        function generateCafePoster() {
            if (!posterGenerator) {
                testPosterClass();
            }
            posterGenerator.generatePoster('cafe');
        }
        
        // Auto-initialize
        log('Page loaded, ready for testing');
    </script>
</body>
</html>
